const fs=require('fs');function main(){const dom='policy/domains.json';if(!fs.existsSync(dom)){console.log('no domains');return}const conf=JSON.parse(fs.readFileSync(dom,'utf8'));const changedFile='reports/changed-files.txt';const changed=fs.existsSync(changedFile)?fs.readFileSync(changedFile,'utf8').split(/\r?\n/).filter(Boolean):[];const hit=new Set();for(const d of (conf.domains||[])){for(const p of (d.paths||[])){const prefix=p.replace('/**','');for(const f of changed){if(f.startsWith(prefix)){hit.add(d.name);break}}}}const arr=Array.from(hit);if(!fs.existsSync('reports'))fs.mkdirSync('reports',{recursive:true});fs.writeFileSync('reports/affected-domains.txt',arr.join(','),'utf8');fs.writeFileSync('reports/affected-domains.json',JSON.stringify(arr,null,2),'utf8');console.log(arr.join(','))}if(require.main===module)main();
