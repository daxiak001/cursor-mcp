rules:
  - id: TEST-001
    level: error
    description: GUIæµ‹è¯•éªŒè¯æ ‡å‡†ï¼ˆä¸ç›¸ä¿¡æ—¥å¿—ï¼Œå¿…é¡»æˆªå›¾éªŒè¯ï¼‰
    category: GUIæµ‹è¯•
    priority: critical
    
    core_principle:
      é”™è¯¯æ€ç»´: "æˆ‘å†™äº†ä»£ç ï¼Œåº”è¯¥èƒ½å·¥ä½œ"
      æ­£ç¡®æ€ç»´: "æˆ‘å¿…é¡»ç”¨æˆªå›¾/ç›‘æ§å·¥å…·äº²çœ¼éªŒè¯ç»“æœ"
      
      å…³é”®è§„åˆ™:
        - ä¸æˆªå›¾ = ä¸éªŒè¯ = ä¸å¯ä¿¡
        - ä»£ç æ‰§è¡ŒæˆåŠŸ â‰  åŠŸèƒ½æ­£ç¡®
        - æ—¥å¿—æ˜¾ç¤º"æˆåŠŸ" â‰  ç”¨æˆ·çœ‹åˆ°äº†ç»“æœ
    
    # æµ‹è¯•æ­¥éª¤æ ‡å‡†
    standard_workflow:
      step1_execute:
        name: æ‰§è¡Œæ“ä½œ
        example: "window.type_keys('æµ‹è¯•å†…å®¹')"
      
      step2_screenshot:
        name: ç«‹å³æˆªå›¾
        required: true
        code: |
          import pyautogui
          import time
          from datetime import datetime
          
          time.sleep(0.5)  # ç­‰å¾…UIæ›´æ–°
          timestamp = datetime.now().strftime("%H%M%S")
          screenshot = pyautogui.screenshot()
          screenshot.save(f"verify_{timestamp}.png")
      
      step3_analyze:
        name: åˆ†ææˆªå›¾
        methods:
          - åƒç´ åˆ†æ
          - æ–‡å­—æ£€æµ‹ï¼ˆOCRï¼‰
          - å›¾åƒå¯¹æ¯”
          - äººå·¥æ£€æŸ¥
        
        code: |
          import cv2
          import numpy as np
          
          img = cv2.imread("verify.png")
          gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
          # åˆ†æå›¾åƒ...
      
      step4_report:
        name: ç”ŸæˆéªŒè¯æŠ¥å‘Š
        required: true
        output: HTMLæŠ¥å‘Š + æˆªå›¾
  
  - id: TEST-002
    level: error
    description: å±å¹•åˆ†è¾¨ç‡æ£€æµ‹ï¼ˆå¿…é¡»å…ˆæ£€æµ‹ï¼Œå†æ“ä½œï¼‰
    category: GUIæµ‹è¯•
    
    requirement:
      æ°¸è¿œå…ˆæ£€æµ‹:
        code: |
          import pyautogui
          
          # ç¬¬ä¸€æ­¥ï¼šæ£€æµ‹åˆ†è¾¨ç‡
          screen_width, screen_height = pyautogui.size()
          print(f"âœ… å±å¹•åˆ†è¾¨ç‡: {screen_width} x {screen_height}")
          
          # ç¬¬äºŒæ­¥ï¼šåŸºäºåˆ†è¾¨ç‡è®¡ç®—åæ ‡
          region_x = screen_width // 2
          region_y = screen_height // 2
          
          # ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œæ“ä½œ
          screenshot = pyautogui.screenshot(region=(
              region_x, region_y, 
              screen_width // 2, screen_height // 2
          ))
      
      ç¦æ­¢ç¡¬ç¼–ç :
        é”™è¯¯: "screenshot = pyautogui.screenshot(region=(0, 0, 1920, 1080))"
        åŸå› : ä¸åŒåˆ†è¾¨ç‡ä¸‹ä¼šå¤±æ•ˆ
        æ­£ç¡®: "åŸºäºåŠ¨æ€æ£€æµ‹çš„åˆ†è¾¨ç‡è®¡ç®—åæ ‡"
  
  - id: TEST-003
    level: error
    description: æ··åˆæ£€æµ‹ç­–ç•¥ï¼ˆpywinauto + OpenCVï¼‰
    category: GUIæµ‹è¯•
    
    strategy:
      å•ä¸€æ–¹æ³•å±€é™:
        pywinauto:
          ä¼˜ç‚¹: ç²¾ç¡®ã€å¯è·å–å±æ€§
          ç¼ºç‚¹: å¯¹Imageæ§ä»¶æ”¯æŒå·®
          æˆåŠŸç‡: 60%
        
        opencv:
          ä¼˜ç‚¹: é€šç”¨ã€è§†è§‰ç›´è§‚
          ç¼ºç‚¹: å¯èƒ½è¯¯åˆ¤ã€éœ€è°ƒå‚
          æˆåŠŸç‡: 70%
        
        æ··åˆç­–ç•¥:
          ä¼˜ç‚¹: äº’è¡¥ä¼˜åŠ¿
          æˆåŠŸç‡: 95%
      
      implementation:
        method1_pywinauto:
          description: æ§ä»¶æ ‘æ‰«æ
          code: |
            all_controls = window.descendants()
            for ctrl in all_controls:
                if ctrl.element_info.control_type in ['Button', 'Image']:
                    candidates.append(ctrl)
        
        method2_opencv:
          description: å›¾åƒè¯†åˆ«
          code: |
            screenshot = pyautogui.screenshot(region=search_area)
            img = cv2.cvtColor(np.array(screenshot), cv2.COLOR_RGB2BGR)
            edges = cv2.Canny(gray, 50, 150)
            contours, _ = cv2.findContours(edges, cv2.RETR_EXTERNAL, 
                                           cv2.CHAIN_APPROX_SIMPLE)
        
        method3_cross_validation:
          description: äº¤å‰éªŒè¯ï¼ˆæœ€é«˜åˆ†ï¼‰
          logic: |
            å¦‚æœpywinautoå’Œopencvéƒ½æ‰¾åˆ°äº†ç›¸åŒä½ç½®ï¼ŒåŠ åˆ†
            ä½ç½®æ¥è¿‘ï¼ˆå®¹å·®10pxï¼‰â†’ å¾—åˆ†+50
            è¿”å›å¾—åˆ†æœ€é«˜çš„å€™é€‰
  
  - id: TEST-004
    level: error
    description: æ¸è¿›å¼æœç´¢ç­–ç•¥ï¼ˆä»ä¸¥æ ¼åˆ°å®½æ¾ï¼‰
    category: GUIæµ‹è¯•
    
    progressive_search:
      level1_strict:
        description: ç²¾ç¡®æœç´¢
        params:
          size_range: [15, 60]
          aspect_ratio: [0.8, 1.2]
          min_area: 100
        
      level2_relaxed:
        description: æ‰©å¤§èŒƒå›´
        params:
          size_range: [10, 80]
          aspect_ratio: [0.5, 2.0]
          min_area: 50
          search_area: æ‰©å¤§100px
      
      level3_super_relaxed:
        description: è¶…å¤§èŒƒå›´
        params:
          size_range: [5, 100]
          aspect_ratio: [0.3, 3.0]
          min_area: 20
          search_area: æ‰©å¤§300px
          æ™ºèƒ½æ’åº: è·ç¦»ç›®æ ‡åŒºåŸŸè¶Šè¿‘ï¼Œå¾—åˆ†è¶Šé«˜
      
      failure_handling:
        - æˆªå›¾è¯Šæ–­
        - æ£€æŸ¥çª—å£çŠ¶æ€
        - æ£€æŸ¥æ§ä»¶æ ‘
        - å»ºè®®äººå·¥å®šä½
  
  - id: TEST-005
    level: error
    description: ç”Ÿæˆäººç±»å¯è¯»çš„éªŒè¯æŠ¥å‘Šï¼ˆHTML + æˆªå›¾ï¼‰
    category: GUIæµ‹è¯•
    
    report_structure:
      html_template:
        sections:
          - æµ‹è¯•æ¦‚å†µï¼ˆæ—¶é—´ã€é¡¹ç›®æ•°ã€åˆ†è¾¨ç‡ï¼‰
          - æ¯ä¸ªæµ‹è¯•é¡¹ï¼ˆçŠ¶æ€ã€æ­¥éª¤ã€æˆªå›¾ï¼‰
          - éªŒè¯æ£€æŸ¥æ¸…å•
        
        features:
          - å½©è‰²çŠ¶æ€æ ‡è®°ï¼ˆæˆåŠŸ/è­¦å‘Š/é”™è¯¯ï¼‰
          - åµŒå…¥æˆªå›¾
          - è¯¦ç»†æ­¥éª¤è¯´æ˜
          - äººå·¥æ£€æŸ¥æç¤º
      
      output_files:
        - verification_report.html
        - screenshots/*.png
        - test_data.json
      
      example_code: |
        def generate_verification_report(test_results):
            html = f'''
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯æŠ¥å‘Š</title>
                <style>
                    .success {{ border-color: #4CAF50; }}
                    .error {{ border-color: #f44336; }}
                </style>
            </head>
            <body>
                <h1>ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯æŠ¥å‘Š</h1>
                {generate_test_items(test_results)}
                <div class="checklist">
                    <h2>ğŸ“‹ éªŒè¯æ£€æŸ¥æ¸…å•</h2>
                    <ul>
                        <li>âœ… æ‰€æœ‰æˆªå›¾æ˜¯å¦æ¸…æ™°å®Œæ•´</li>
                        <li>âœ… è¾“å…¥çš„æ–‡å­—æ˜¯å¦æ­£ç¡®æ˜¾ç¤º</li>
                        <li>âœ… æŒ‰é’®ä½ç½®æ ‡è®°æ˜¯å¦å‡†ç¡®</li>
                    </ul>
                </div>
            </body>
            </html>
            '''
            with open("verification_report.html", "w", encoding="utf-8") as f:
                f.write(html)
  
  - id: TEST-006
    level: error
    description: ç©·å°½å¼ç›®æ ‡æœç´¢ï¼ˆä¸å‡è®¾ï¼Œä¸é—æ¼ï¼‰
    category: GUIæµ‹è¯•
    
    principles:
      ä¸è¦å‡è®¾:
        - "1ä¸ªçª—å£ = 1ä¸ªè¾“å…¥æ¡†" âŒ
        - "çœ‹å¾—è§çš„æ‰éœ€è¦æ£€æµ‹" âŒ
        - "æœ€å°åŒ–çš„çª—å£å¯ä»¥å¿½ç•¥" âŒ
      
      æ­£ç¡®åšæ³•:
        - æ‰«ææ‰€æœ‰çª—å£
        - æŸ¥æ‰¾æ‰€æœ‰æ§ä»¶ï¼ˆåŒ…æ‹¬ä¸å¯è§çš„ï¼‰
        - è¿›ä¸€æ­¥ç­›é€‰ç¬¦åˆç‰¹å¾çš„
        - ç»Ÿè®¡å’ŒæŠ¥å‘Šæ‰€æœ‰ç»“æœ
      
      example_code: |
        def find_all_input_targets(windows):
            all_targets = []
            
            for window_idx, window in enumerate(windows):
                # ä¸è¦åªæ‰¾"å¯è§"çš„ï¼Œè¦æ‰¾"æ‰€æœ‰"çš„
                all_controls = window.descendants()
                
                for ctrl in all_controls:
                    if ctrl.element_info.control_type in ['Edit', 'Document', 'Text']:
                        # ä¸è¦è¿‡æ»¤"ä¸å¯è§"çš„
                        # å®ƒå¯èƒ½åªæ˜¯è¢«è¦†ç›–æˆ–åœ¨åå°
                        all_targets.append(ctrl)
            
            return all_targets
  
  - id: TEST-007
    level: error
    description: å¤±è´¥æ—¶çš„ç³»ç»ŸåŒ–æ’æŸ¥
    category: GUIæµ‹è¯•
    
    diagnostic_workflow:
      check1_window_status:
        - çª—å£æ˜¯å¦å­˜åœ¨
        - çª—å£æ ‡é¢˜
        - çª—å£ä½ç½®å’Œå°ºå¯¸
      
      check2_screen_resolution:
        - å½“å‰åˆ†è¾¨ç‡
        - çª—å£æ˜¯å¦åœ¨å±å¹•å¤–
      
      check3_screenshot_test:
        - å…¨å±æˆªå›¾
        - çª—å£æˆªå›¾
        - ä¿å­˜è¯Šæ–­å›¾åƒ
      
      check4_control_tree:
        - æ€»æ§ä»¶æ•°
        - æ§ä»¶ç±»å‹åˆ†å¸ƒ
        - TOP10æ§ä»¶ç±»å‹
      
      check5_visual_check:
        - æŸ¥çœ‹è¯Šæ–­æˆªå›¾
        - ç¡®è®¤ç›®æ ‡å…ƒç´ æ˜¯å¦å¯è§
        - å»ºè®®ä½¿ç”¨äº¤äº’å¼å·¥å…·
      
      diagnostic_report:
        - æ€»ç»“æ‰€æœ‰æ£€æŸ¥ç»“æœ
        - æä¾›ä¸‹ä¸€æ­¥å»ºè®®
        - è®°å½•è¯Šæ–­æ—¥å¿—

  - id: TEST-008
    level: error
    description: å¿…éœ€çš„Pythonåº“å’Œå¯¼å…¥æ¨¡æ¿
    category: GUIæµ‹è¯•
    
    required_libraries:
      installation: "pip install pywinauto pyautogui opencv-python pillow numpy"
      
      import_template: |
        import pyautogui          # æˆªå›¾ã€é¼ æ ‡æ§åˆ¶
        import cv2                # å›¾åƒå¤„ç†
        import numpy as np        # æ•°å€¼è®¡ç®—
        from pywinauto import Desktop  # UIè‡ªåŠ¨åŒ–
        from PIL import Image     # å›¾åƒæ“ä½œ
        import time               # å»¶æ—¶
        from datetime import datetime  # æ—¶é—´æˆ³
  
  - id: TEST-009
    level: error
    description: AIå·¥ä½œå‰çš„æ£€æŸ¥æ¸…å•
    category: GUIæµ‹è¯•
    
    pre_work_checklist:
      questions:
        - question: æˆ‘æ˜¯å¦å…ˆæ£€æµ‹äº†å±å¹•åˆ†è¾¨ç‡ï¼Ÿ
          required: true
        
        - question: æˆ‘æ˜¯å¦è®¡åˆ’åœ¨æ“ä½œåç«‹å³æˆªå›¾éªŒè¯ï¼Ÿ
          required: true
        
        - question: æˆ‘æ˜¯å¦å‡†å¤‡äº†æ··åˆæ£€æµ‹ç­–ç•¥ï¼Ÿ
          required: true
        
        - question: æˆ‘æ˜¯å¦è€ƒè™‘äº†æ¸è¿›å¼æœç´¢ï¼Ÿ
          required: true
        
        - question: æˆ‘æ˜¯å¦ä¼šç”Ÿæˆäººç±»å¯è¯»çš„éªŒè¯æŠ¥å‘Šï¼Ÿ
          required: true
        
        - question: æˆ‘æ˜¯å¦ä¼šç©·å°½æœç´¢æ‰€æœ‰å¯èƒ½çš„ç›®æ ‡ï¼Ÿ
          required: true
        
        - question: æˆ‘æ˜¯å¦å‡†å¤‡äº†å¤±è´¥è¯Šæ–­æµç¨‹ï¼Ÿ
          required: true
      
      rule: å¦‚æœä»¥ä¸Šä»»ä½•ä¸€é¡¹æ˜¯"å¦"ï¼Œåœä¸‹æ¥é‡æ–°è®¾è®¡æ–¹æ¡ˆï¼
  
  - id: TEST-010
    level: error
    description: æˆåŠŸæ ‡å‡†ï¼ˆ5ä¸ªå¿…éœ€ç»„ä»¶ï¼‰
    category: GUIæµ‹è¯•
    
    success_criteria:
      component1:
        name: ä»£ç æ‰§è¡Œ
        required: true
      
      component2:
        name: ç«‹å³æˆªå›¾
        required: true
      
      component3:
        name: å›¾åƒåˆ†æ
        required: true
        note: å¯ä»¥æ˜¯è‡ªåŠ¨åˆ†ææˆ–äººå·¥æ£€æŸ¥
      
      component4:
        name: HTMLæŠ¥å‘Š
        required: true
      
      component5:
        name: æ¸…æ™°çš„éªŒè¯æŒ‡å¼•
        required: true
        note: å‘Šè¯‰äººç±»çœ‹ä»€ä¹ˆ
      
      example_output: |
        âœ… å±å¹•åˆ†è¾¨ç‡: 2560 x 1440
        âœ… æ‰¾åˆ° 2 ä¸ªCursorçª—å£
        âœ… æ£€æµ‹åˆ° 3 ä¸ªæŒ‰é’®
        âœ… éªŒè¯å›¾å·²ä¿å­˜: button_verification.png
        âœ… HTMLæŠ¥å‘Šå·²ç”Ÿæˆ: verification_report.html
        
        ğŸ“‹ è¯·éªŒè¯ï¼š
           1. æ‰“å¼€ button_verification.png
           2. ç¡®è®¤çº¢è‰²æ–¹æ¡†æ˜¯å¦åœ¨æ­£ç¡®ä½ç½®
           3. å¦‚æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹ verification_report.html è¯¦æƒ…

  - id: TEST-011
    level: error
    description: å¸¸è§é”™è¯¯åŠä¿®æ­£
    category: GUIæµ‹è¯•
    
    common_mistakes:
      mistake1_only_logs:
        é”™è¯¯: "print('âœ… æŒ‰é’®ç‚¹å‡»æˆåŠŸ')"
        æ­£ç¡®: |
          print("âœ… æŒ‰é’®ç‚¹å‡»æˆåŠŸ")
          screenshot = pyautogui.screenshot()
          screenshot.save("after_click.png")
          print("   éªŒè¯æˆªå›¾: after_click.png")
      
      mistake2_hardcoded_coordinates:
        é”™è¯¯: "pyautogui.click(1920, 1080)"
        æ­£ç¡®: |
          screen_w, screen_h = pyautogui.size()
          pyautogui.click(screen_w - 100, screen_h - 100)
      
      mistake3_single_target_assumption:
        é”™è¯¯: "input_box = window.child_window(control_type='Edit')"
        æ­£ç¡®: |
          all_input_boxes = [ctrl for ctrl in window.descendants()
                             if ctrl.element_info.control_type == "Edit"]
          print(f"æ‰¾åˆ° {len(all_input_boxes)} ä¸ªè¾“å…¥æ¡†")
      
      mistake4_give_up_on_failure:
        é”™è¯¯: |
          result = find_button(strict_params)
          if not result:
              print("å¤±è´¥")
              return
        
        æ­£ç¡®: |
          result = find_button(strict_params)
          if not result:
              result = find_button(relaxed_params)
              if not result:
                  result = find_button(super_relaxed_params)
                  if not result:
                      diagnose_and_suggest_manual()

