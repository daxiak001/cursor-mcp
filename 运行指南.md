# 运行指南（本地）

初始化（一次性）：
1) PowerShell 以当前用户允许脚本执行
   - Set-ExecutionPolicy -Scope CurrentUser RemoteSigned
2) 绑定Git Hooks路径
   - git config core.hooksPath hooks
3) 安装依赖工具（按需）
   - Node: npm ci / 安装 eslint、prettier
   - Python: pip install ruff black pytest
   - 安全：semgrep、gitleaks
4) 启用Git提交模板（可选）
   - scripts/enable_gitmessage.ps1 生成命令
   - 执行：git config commit.template .gitmessage.txt

常用脚本（scripts/）：
- setup.ps1：初始化（执行1、2步）
- add_log.ps1：追加记录
  - 示例：
    - ./scripts/add_log.ps1 -Type TASK -Message "S1-2 实现禁硬编码检查"
    - ./scripts/add_log.ps1 -Type TEST -Message "选测通过 覆盖率82%" -Evidence "./tests/report.html"
- add_stage.ps1：追加阶段里程碑
  - 示例：
    - ./scripts/add_stage.ps1 -StageId S2 -Summary "改表即用演示完成" -Deliverables "policy/*" -Evidence "本地"
- run_tests_locally.ps1：本地运行测试占位
- set_exception.ps1：维护灰度例外（policy/exceptions.json）
  - 示例：
    - ./scripts/set_exception.ps1 -Path "tests/fixtures/**" -Rules IR-003 -Expires "2025-11-01"
    - ./scripts/set_exception.ps1 -Path "src/utils/**" -Rules IR-003,IR-010 -Expires "2025-12-31"
 - enable_auto_confirm.ps1 / disable_auto_confirm.ps1：启用/停用自动确认
   - 示例：
     - ./scripts/enable_auto_confirm.ps1  # 写入 Cursor settings.json, 设置环境变量 XIAOLIU_AUTO_CONFIRM=1
     - ./scripts/disable_auto_confirm.ps1 # 关闭自动确认
 - generate_domain_smoke_tests.cjs：按 policy/domains.json 生成缺失的 tests/smoke/<domain>.smoke.test.ts 占位
 - augment_tests.cjs：将域冒烟用例加入 tests-to-run-augmented.txt（配合受影响域）

Hooks与CI：
- 本地：hooks/pre-commit.ps1、hooks/pre-push.ps1（可按需增减）
- 远端：ci/pipeline.yml（推到GitHub/GitLab后按PR触发）

入口：
- 单窗口流程从 ./快速索引.md → ./窗口/窗口A_执行.txt 开始
