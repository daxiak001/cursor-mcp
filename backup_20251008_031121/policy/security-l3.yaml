rules:
  - id: SEC-001
    level: error
    description: SQL注入防护（禁止字符串拼接SQL，必须使用参数化查询）
    patterns:
      type: regex
      patterns:
        - 'SELECT\s+.*\s+\+\s*["\']'
        - 'INSERT\s+.*\s+\+\s*["\']'
        - 'UPDATE\s+.*\s+\+\s*["\']'
        - 'DELETE\s+.*\s+\+\s*["\']'
        - 'WHERE\s+.*\s+\+\s*["\']'
      message: 检测到SQL注入风险，禁止字符串拼接SQL
  
  - id: SEC-002
    level: error
    description: XSS防护（禁止直接输出用户输入，必须转义）
    patterns:
      type: regex
      patterns:
        - 'innerHTML\s*=\s*[^"]'
        - 'outerHTML\s*=\s*[^"]'
        - 'document\.write\s*\('
        - 'eval\s*\('
      message: 检测到XSS风险，禁止直接输出用户输入
  
  - id: SEC-003
    level: error
    description: 敏感信息泄露防护（禁止硬编码密码、密钥、Token）
    patterns:
      type: regex
      patterns:
        - 'password\s*[:=]\s*["\'][^"\']{3,}'
        - 'secret\s*[:=]\s*["\'][^"\']{3,}'
        - 'apiKey\s*[:=]\s*["\'][^"\']{3,}'
        - 'token\s*[:=]\s*["\'][^"\']{3,}'
        - 'accessKey\s*[:=]\s*["\'][^"\']{3,}'
      exclude:
        - 'password:\s*process\.env'
        - 'secret:\s*process\.env'
        - 'token:\s*process\.env'
      message: 检测到敏感信息硬编码，必须使用环境变量
  
  - id: SEC-004
    level: warn
    description: 命令注入防护（禁止直接执行用户输入的命令）
    patterns:
      type: regex
      patterns:
        - 'exec\s*\([^)]*\+[^)]*\)'
        - 'spawn\s*\([^)]*\+[^)]*\)'
        - 'execSync\s*\([^)]*\+[^)]*\)'
      message: 检测到命令注入风险
  
  - id: SEC-005
    level: warn
    description: 路径遍历防护（禁止直接拼接用户输入路径）
    patterns:
      type: regex
      patterns:
        - 'readFile\s*\([^)]*\+[^)]*\)'
        - 'writeFile\s*\([^)]*\+[^)]*\)'
        - '__dirname\s*\+\s*req\.'
        - '__dirname\s*\+\s*params\.'
      message: 检测到路径遍历风险，使用path.join且验证路径
  
  - id: SEC-006
    level: info
    description: HTTPS强制（生产环境必须使用HTTPS）
    patterns:
      type: regex
      patterns:
        - 'http:\/\/(?!localhost|127\.0\.0\.1)'
      message: 生产环境应使用HTTPS
  
  - id: SEC-007
    level: warn
    description: 密码复杂度要求（密码必须加密存储）
    patterns:
      type: regex
      patterns:
        - 'INSERT.*password.*VALUES.*["\'][^"\']*["\']'
      exclude:
        - 'bcrypt'
        - 'hash'
        - 'encrypt'
      message: 密码必须加密后存储
