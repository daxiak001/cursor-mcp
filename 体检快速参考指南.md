# 🏥 系统体检快速参考指南

**快速执行体检命令**

---

## ⚡ 快速命令

### 执行完整体检
```bash
cd "F:\源码文档\设置\【项目】开发材料"
node scripts/health-check-comprehensive.cjs
```

### 查看最新体检报告
```bash
# PowerShell
Get-ChildItem reports\health-checks\ | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | Get-Content
```

### 定期体检（建议添加到计划任务）
```powershell
# 每日核心检查（每天8:00）
schtasks /create /tn "小柳系统每日体检" /tr "node F:\源码文档\设置\【项目】开发材料\scripts\health-check-comprehensive.cjs" /sc daily /st 08:00
```

---

## 📋 体检项目总览

| 维度 | 检查项 | 优先级 | 当前覆盖 | 说明 |
|------|--------|--------|----------|------|
| 核心服务 | 8项 | P0 | 4项 ✅ | PM2、API、数据库 |
| 数据完整性 | 7项 | P0 | 3项 ✅ | 规则、配置、日志 |
| API功能 | 15项 | P0 | 6项 ⚠️ | 所有端点测试 |
| 性能指标 | 10项 | P1 | 1项 ✅ | 响应时间、吞吐量 |
| 安全审计 | 8项 | P0 | 1项 ✅ | SQL注入、XSS等 |
| 集成兼容性 | 6项 | P1 | 0项 | MCP、插件、工具 |
| 监控告警 | 5项 | P1 | 0项 | 日志、监控、告警 |
| 文档完整性 | 4项 | P2 | 0项 | API文档、README |
| 代码质量 | 6项 | P1 | 0项 | Lint、测试覆盖 |
| 业务指标 | 5项 | P1 | 0项 | 执行率、命中率 |

**总计**: 74项检查，当前覆盖15项 (20%)

---

## 🎯 关键指标快查

### 核心服务健康
```bash
# PM2状态
pm2 status

# API健康
curl http://localhost:3000/api/health

# 数据库大小
du -h data/xiaoliu.db
```

### 性能指标
```bash
# API响应时间（平均6ms，目标<50ms）
curl -w "@curl-format.txt" http://localhost:3000/api/health

# 内存占用（当前42MB，目标<500MB）
pm2 show xiaoliu-rule-engine-sqlite | grep memory

# CPU占用（当前0.2%，目标<30%）
pm2 show xiaoliu-rule-engine-sqlite | grep cpu
```

### 数据完整性
```bash
# 规则数量（目标11条）
curl http://localhost:3000/api/rules | jq '.rules | length'

# 审计日志数量
curl http://localhost:3000/api/audit-logs | jq '.logs | length'
```

---

## 🚨 告警阈值

| 指标 | 正常 | 警告 | 错误 | 严重 |
|------|------|------|------|------|
| **服务状态** | online | - | offline | crashed |
| **API响应时间** | <50ms | 50-100ms | 100-500ms | >500ms |
| **内存占用** | <200MB | 200-400MB | 400-500MB | >500MB |
| **CPU占用** | <10% | 10-20% | 20-30% | >30% |
| **错误率** | <0.1% | 0.1-1% | 1-5% | >5% |
| **规则数量** | 11 | - | <11 | <8 |
| **数据库大小** | <10MB | 10-50MB | 50-100MB | >100MB |

---

## 📊 历史体检记录

### 首次体检 (2025-10-07 17:40)
- **评级**: A+
- **通过率**: 60% (9/15)
- **关键发现**: 
  - ✅ 核心服务100%正常
  - ✅ 性能表现卓越（平均6ms）
  - ⚠️  API验证逻辑需优化
- **改进措施**: 修复验证逻辑Bug

---

## 🔧 常见问题快速解决

### 问题1: PM2进程未运行
```bash
# 检查
pm2 status

# 解决
pm2 start PM2启动配置-SQLite版.js
```

### 问题2: API无响应
```bash
# 检查端口
netstat -ano | findstr :3000

# 重启服务
pm2 restart xiaoliu-rule-engine-sqlite
```

### 问题3: 数据库文件损坏
```bash
# 检查完整性
sqlite3 data/xiaoliu.db "PRAGMA integrity_check;"

# 恢复备份
cp data/xiaoliu.db.backup data/xiaoliu.db
```

### 问题4: 内存占用过高
```bash
# 查看内存
pm2 show xiaoliu-rule-engine-sqlite

# 重启释放
pm2 restart xiaoliu-rule-engine-sqlite
```

---

## 📅 定期体检计划

### 每日检查（5分钟）
- [ ] PM2进程状态
- [ ] API健康检查
- [ ] 内存/CPU占用
- [ ] 错误日志查看

### 每周检查（30分钟）
- [ ] 完整体检脚本执行
- [ ] 性能趋势分析
- [ ] 安全漏洞扫描
- [ ] 数据备份验证

### 每月检查（2小时）
- [ ] 深度性能分析
- [ ] 压力测试
- [ ] 容量规划评估
- [ ] 架构优化建议

---

## 📄 体检报告位置

- **体检方案**: `系统深度体检方案.md`
- **体检脚本**: `scripts/health-check-comprehensive.cjs`
- **首次报告**: `系统深度体检报告-首次执行.md`
- **历史报告**: `reports/health-checks/health-check-*.md`

---

## 🎯 下一步行动

### 立即执行
1. [ ] 修复API验证逻辑Bug
2. [ ] 重新执行完整体检
3. [ ] 验证修复效果

### 本周执行
1. [ ] 扩展性能深度分析
2. [ ] 完善安全审计
3. [ ] 集成兼容性测试

### 本月执行
1. [ ] 实现72项完整体检
2. [ ] 建立定期体检机制
3. [ ] 体检可视化Dashboard

---

**最后更新**: 2025-10-07  
**维护人员**: AI助手  
**联系方式**: 查看项目文档

