# 三阶段升级总计划（MCP → ZPCP → VDCP）

概述：按三阶段逐步升级规则执行力与质量保障。单窗口执行，所有动作需同步登记，避免断档。

路线图：
- S1（1–2周）：MCP 精简强制（10→20条）
- S2（2–4周）：ZPCP 策略控制平面（policy/hooks/ci，“改表即用”）
- S3（3–6周）：VDCP 核心域（AST受控 + 契约选测）

---

## S1 MCP 精简版
- 目标：写代码/回复前强制检查；禁询问/禁硬编码/查重/先解释；实时测试
- 交付：
  - 目录：`./mcp/`（tools与规范）
  - 规则/模式：`./mcp/tools/xiaoliu_write_code.md`、`./mcp/tools/_patterns.hardcode.txt`、`./mcp/tools/xiaoliu_respond_to_user.md`
  - 预检报告：`./测试/预检报告_S1-2.md`
- 入口：
  - 任务清单：`./S1_任务清单.md`
  - 工具契约：`./接口/工具契约.schemas.json`
- 验收：遵守率≥95%；平均延迟≤350ms；完成一次开发→测试→登记闭环
- 里程碑登记：在`./阶段登记表.md`追加[#STAGE]

## S2 ZPCP 策略控制平面
- 目标：策略即代码，提交与合并链路强制执行；新增规则“改表即用”
- 交付：
  - 策略：`./policy/core-l1.yaml`、`./policy/quality-l2.yaml`、`./policy/security-l3.yaml`、`./policy/routing.json`、`./policy/exceptions.json`
  - 门禁：`./hooks/pre-commit.ps1`、`./hooks/pre-push.ps1`、`./ci/pipeline.yml`
  - 演示：L1新增`IR-038`（改表即用）
- 入口：
  - 任务清单：`./S2_任务清单.md`
  - 使用指南：`./技术规范/CI与Hooks使用指南.md`
- 验收：新规则改表后本地/CI可感知；自愈链可运行（lint/format/占位）
- 里程碑登记：在`./阶段登记表.md`追加[#STAGE]

## S3 VDCP 核心域
- 目标：核心模块采用AST受控变更 + 契约双向校验 + 差异选测
- 交付：
  - 目录：`./vdcp/`（规范、Schema、选测流程、核心域清单）
  - 演示报告：`./测试/VDCP演示报告_S3-4.md`（覆盖率≥80%）
- 入口：
  - 任务清单：`./S3_任务清单.md`
  - 规范/Schema：`./vdcp/apply_ast_patch.md`、`./vdcp/ast_patch.schema.json`
  - 选测流程：`./vdcp/差异选测.md`
- 验收：核心域遵守率≈99%；选测覆盖率阈值达标
- 里程碑登记：在`./阶段登记表.md`追加[#STAGE]

---

执行入口与登记（固定）：
- 入口：`./快速索引.md` → `./窗口/窗口A_执行.txt`
- 过程登记：`./开发跟进记录.md`（[#TASK]/[#TEST]/[#NOTE]）
- 阶段登记：`./阶段登记表.md`（[#STAGE]）
- 交付总览：`./交付摘要.md`

恢复上下文：
1) 打开`./开发跟进记录.md`找最近[#TASK]/[#STAGE]
2) 回到`./窗口/窗口A_执行.txt`继续执行
3) 达标后在`./阶段登记表.md`登记并开始下一阶段任务
